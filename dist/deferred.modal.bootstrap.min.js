/**
 * @file bootstrap-modal-deferred.js provides a wrapper to the standard
 *       Bootstrap Modal component that returns a promise that will be rejected
 *       or resolved via interaction with the modal.
 * @version 1.0.0
 * @copyright Jim Auldridge <auldridgej@gmail.com> 2016
 * @license MIT
 * @see {@link https://github.com/JAAulde/bootstrap-modal-deferred|GitHub Repository}
 * @see {@link http://getbootstrap.com/javascript/#modals|Bootstrap Modal}
 * @see {@link https://api.jquery.com/category/deferred-object/|jQuery deferred}
 */
!function(E,D){"use strict";var e=E.jQuery,_={rejectOnDismiss:!0,returnDeferred:!0},a={DATA_ATTR_PROMISE_DISPATCH:"data-promise-dispatch",DATA_KEY_PROMISE_DISPATCH:"promiseDispatch",DATA_KEY_DEFERRED:"modalDeferred",DATA_KEY_RETURN_DEFERRED:"returnDeferred",DATA_KEY_REJECT_ON_DISMISS:"rejectOnDismiss",VALUE_PENDING_DEFERRED_STATE:"pending"},t=function(E){var D=e.Deferred();D.always(function(){E.modal("hide")}),E.data(a.DATA_KEY_DEFERRED,D)};e.fn.modalDeferred=function(E){var A,r,R=this;if("string"==typeof E)switch(E){case"deferred":A=R.data(a.DATA_KEY_DEFERRED);break;default:R.modal(E)}else r=e.extend({},_,E||{}),R.each(function(){var E=e(this);t(E),E.data(a.DATA_KEY_RETURN_DEFERRED,r.returnDeferred).data(a.DATA_KEY_REJECT_ON_DISMISS,r.rejectOnDismiss).on("show.bs.modal",function(){var D=E.data(a.DATA_KEY_DEFERRED);D&&D.state()===a.VALUE_PENDING_DEFERRED_STATE||t(E)}).on("hide.bs.modal",function(){var D=E.data(a.DATA_KEY_DEFERRED);D.state()===a.VALUE_PENDING_DEFERRED_STATE&&D[E.data(a.DATA_KEY_REJECT_ON_DISMISS)?"reject":"resolve"]()}).on("click","["+a.DATA_ATTR_PROMISE_DISPATCH+"]",function(){var D="resolve"===e(this).data(a.DATA_KEY_PROMISE_DISPATCH);E.data(a.DATA_KEY_DEFERRED)[D?"resolve":"reject"](),E.modal("hide")}).modal(r)});return A===D&&(A=1===R.length&&R.data(a.DATA_KEY_RETURN_DEFERRED)?R.data(a.DATA_KEY_DEFERRED):R),A}}(this);